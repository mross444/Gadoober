-- Use this format for direct TM login: https://laserspine.stage.sumtotal.host/scripts/lightyearisapi.dll?outputresource&resource=login/login.htm&clientcd=47&softscapelogin=1

--Fix Employee Type field (JM Family case)
Update GlobalEntityField
set CatcdFK = '4030' 
where GlobalEntityFieldPK = 314



SELECT * FROM SettingDefinition WHERE SettinDefinitionKey = 'UDP_REQUIRES_APPROVAL'


SELECT ReceiveAutoEmailsFlg, COUNT(*)
FROM UserSystemProfile
WHERE RsrcID IN
(
	SELECT RsrcID FROM SResource WHERE RsrcID > 11 AND StsCd = 0
)
GROUP BY ReceiveAutoEmailsFlg

UPDATE UserSystemProfile
SET ReceiveAutoEmailsFlg = 1
WHERE RsrcID > 11

--Update existing users to have ReceiveAutoEmailsFlg = 1 
UPDATE UserSystemProfile 
SET ReceiveAutoEmailsFlg = 1 
WHERE RsrcID > 11 

--Set synch flag 
UPDATE SResource 
SET SynchFaultFlg = 2, SynchFaultRetryCt = 1
WHERE RsrcID > 11 


SELECT TOP 30 *
FROM Person t1
JOIN PersonTM t2 on t1.PersonPK = t2.PersonFK
WHERE t2.PerfRatingCode = 0



SELECT TOP 30 *
FROM Event t1
JOIN Person t2 ON t1.ownrid = t2.personpk
JOIN EventDefinition t3 ON t1.typcd = t3.typcd
WHERE t1.StsCd = 3 AND t3.ModuleCd <> 'hiring'



SELECT TOP 10 *
FROM Person 
WHERE PersonPK NOT IN
(
	SELECT OwnrID From Event
)
AND PersonPK > 11 AND Active = 1

SELECT TOP 30 * FROM EmailOutArc ORDER BY CrtDt DESC


SELECT TOP 30 * 
FROM Event t1
JOIN Person t2 ON t1.OwnrID = t2.PersonPK
WHERE t1.TypCd = 100053 AND t2.Active = 1



SELECT t2.msgtxt, t1.*
FROM EventDefinition t1
JOIN Message t2 ON t1.NmCd = t2.MsgCd
WHERE t1.TypCd > 99999 AND t2.LngCd = 0


SELECT TOP 10 * FROM BatchProgress

SELECT StsCd, COUNT(*)
FROM BatchProgress
GROUP BY StsCd

SELECT * FROM BatchProgress WHERE StsCd = 3



SELECT TOP 100 *
FROM BatchLog t1
JOIN BatchJob t2 on t1.JobID = t2.JobID
WHERE t1.JobID = 'sys_fulltextupdate'
ORDER BY t1.StartTs DESC

SELECT TOP 100 *
FROM BatchLog t1
JOIN BatchJob t2 on t1.JobID = t2.JobID
WHERE t1.JobID = 'sys_oop_fulltextupdate'
ORDER BY t1.StartTs DESC


SELECT SynchFaultFlg, SynchFaultRetryCt, COUNT(*)
FROM SResource
WHERE RsrcID > 11
GROUP BY SynchFaultFlg, SynchFaultRetryCt


SELECT * FROM Person WHERE PersonNumber = '102'

SELECT TOP 10 * FROM Person


SELECT TOP 10 * FROM Job


SELECT TOP 10 t2.MsgTxt
FROM SurveyDefinition t1
JOIN Message t2 ON t1.TtlID = t2.MsgCd
WHERE t1.SvyID = 'KUDSM2GPUFF3CJ00A1B94RIM' AND t2.LngCd = 0


SELECT TOP 30 *
FROM BatchLog t1
JOIN BatchJob t2 ON t1.JobID = t2.JobID
ORDER BY t1.StrtTs DESC



SELECT ProcessCoordinatorFK, COUNT(*)
FROM PersonRelation
WHERE PersonFK > 11
GROUP BY ProcessCoordinatorFK


SELECT *
FROM Person t1
JOIN PersonRelation t2 ON t1.PersonPK = t2.PersonFK
WHERE t2.ProcessCoordinatorFK = 102840



SELECT TOP 10 * FROM Code

SELECT TOP 10 * FROM Code WHERE CatCd = 1098

SELECT TOP 10 * FROM CodeAttribute



SELECT *
FROM Code t1
JOIN CodeAttribute t2 ON t1.ItmCd = t2.ItmCd
WHERE t1.CatCd = 1098 AND t2.CatCd = 1098
LIMIT 10


SELECT SynchFaultFlg, SynchFaultRetryCt, COUNT(*)
FROM SResource
WHERE RsrcID > 11
GROUP BY SynchFaultFlg, SynchFaultRetryCt


SELECT TOP 10 * FROM BatchLog
ORDER BY StartTs DESC


SELECT TOP 10 * FROM Organization
SELECT TOP 10 * FROM OrganizationLang



--Shows records where Organization name is inconsistent
SELECT COUNT(*)
FROM Organization t1
LEFT JOIN OrganizationLang t2 on t1.OrganizationPK = t2.OrganizationFK
WHERE t2.LangFk = 1 AND t1.Name <> t2.Name



SELECT TOP 10 * FROM CMDetail

SELECT * FROM Person WHERE FirstName = 'Amy' AND LastName = 'Jones'
SELECT COUNT(*) FROM CMDetail WHERE RsrcID = 1003978



SELECT TOP 30 * FROM PersonTM WHERE PersonFK > 11 AND PerfRatingCode IS NOT NULL


SELECT TOP 30 * FROM Person WHERE PersonPK IN
(
	SELECT OwnrID FROM Event
)
AND Active = 1


SELECT TOP 10 * FROM Person WHERE PersonPK IN
(
	SELECT PersonFK FROM PersonRelation WHERE ProcessCoordinatorFK <> 100001 OR ProcessCoordinatorFK IS NULL
)




SELECT * FROM SResource WHERE FllNm = 'Steven Lewis'

UPDATE SResource SET SynchFaultRetryCt = 1 WHERE RsrcID = 105698

/*
UPDATE eventrel SET evntid = '0'
WHERE reltypcd = 100066

UPDATE event
SET enddt = '02/24/2017 20:00:00.000' 
WHERE typcd = 100041 AND ownrid IN (105491,105400)


UPDATE event
SET enddt = '02/24/2017 20:00:00.000' 
WHERE typcd = 100041 AND stscd IN (1,2)

*/

SELECT TOP 30 * FROM SoapActionHistory ORDER BY CrtDt DESC



SELECT ValueTxt
FROM SSConfig
WHERE ParameterTxt IN ('strwebservicebaseurl49000', 'strwebservicebaseurl49000entrypoint', 'strmaestrowsusername', 'strmaestrowspassword')


UPDATE SResource 
SET MaestroEmpID = RsrcNum 
WHERE RsrcID = 105698


SELECT TOP 30 FullName FROM Person
WHERE PersonPK IN
(
	SELECT RsrcID FROM EventRel WHERE RelTypCd = 100001 AND StsCd IN (1,2)
)
AND Active = 1



SELECT COUNT(*) FROM MatrixGoal



SELECT TOP 50 * FROM MatrixGoal ORDER BY CrtSetTs DESC


SELECT TOP 30 t2.FllNm, t3.FllNm AS manager_name, t1.*
FROM MatrixGoal t1
JOIN SResource t2 ON t1.RsrcID = t2.RsrcID
JOIN SResource t3 ON t2.Mgr1ID = t3.RsrcID
ORDER BY t1.CrtSetTs DESC




-- Niles Collins - 00106571
-- EvntID SCBSSO1NKREAK480A1BBU054

SELECT t2.dta
FROM ObjDoc t1
JOIN Doc t2 ON t1.DocID = t2.DocID
WHERE t1.ObjID = 'SCBSSO1NKREAK480A1BBU054'


SELECT TOP 40 * FROM Report
ORDER BY CrtDt Desc



SELECT TOP 100 t2.FullName, t1.*
FROM Report t1
JOIN Person t2 on t1.OwnrID = t2.PersonPK
ORDER BY t1.CrtSetTs DESC


UPDATE Report SET DelFlg = 1 WHERE RprtID = '6IQFS8Q86C1KPGO0A1BBU9QQ'
UPDATE Report SET EvntID = '0' WHERE RprtID = '6IQFS8Q86C1KPGO0A1BBU9QQ'

SELECT * FROM Report WHERE RprtID = '6IQFS8Q86C1KPGO0A1BBU9QQ'


SELECT PersonNumber
FROM Person
WHERE PersonPK > 11


SELECT TOP 50 StartTs, EndTs, LogTxt
FROM BatchLog
WHERE JobID = 'DNBH7LCDSI98F1O0A1BBU42L'
ORDER BY StartTs DESC

SELECT TOP 50 * FROM BatchLog



SELECT * FROM Event WHERE OwnrID IN
(
	SELECT PersonPK FROM Person WHERE FirstName = 'Carlee'
)


SELECT * FROM EventRel WHERE EvntID = 'O9UE81H1I41DKGO0A1BBUDO8'

SELECT t2.FullName, t1.*
FROM EventRel t1
JOIN Person t2 on t1.RsrcID = t2.PersonPK
WHERE t1.EvntID = 'O9UE81H1I41DKGO0A1BBUDO8'




UPDATE EventRel SET StsCd = 2 WHERE EvntRelID = '6CNAM5Q2FKD3EM00A1BBUG0P'

SELECT * FROM EventRel WHERE EvntRelID = '6CNAM5Q2FKD3EM00A1BBUG0P'



SELECT TOP 30 * FROM SResource WHERE LstNm = 'Flanagan'
-- Rsrcid: 103751

SELECT TOP 30 * FROM JobUser WHERE UserID = 103751
-- JobID: SBI2FTIDNTO4RL80A1BBUPM7

SELECT TOP 30 * FROM JobTemplate WHERE ActID = 'SBI2FTIDNTO4RL80A1BBUPM7'



SELECT SynchFaultFlg, SynchFaultCntLstAry, COUNT(*)
FROM JobTemplate
GROUP BY SynchFaultFlg, SynchFaultCntLstAry


SELECT TOP 30 * FROM Person WHERE FullName IN ('Technical Support', 'Professional Services')

SELECT TOP 30 * FROM GroupRelationship WHERE RsrcID IN (11,19267)



SELECT COUNT(*) FROM TMPersonView WHERE FullName = 'Techncial Support'
SELECT * FROM TMPersonView WHERE FullName = 'Techncial Support'

SELECT TOP 10 * FROM JobUser


SELECT TOP 30 * FROM Person WHERE LastName = 'Duba'
SELECT TOP 30 * FROM Person WHERE LastName = 'Lancaster'

SELECT * FROM JobUser WHERE PersonFK = 100871

SELECT *
FROM JobUser t1
JOIN JobTemplate t2 ON t1.JobTemplateFK = t2.JobTemplatePK
WHERE t1.PersonFK = 100871

SELECT *
FROM JobUser t1
JOIN JobTemplate t2 ON t1.JobTemplateFK = t2.JobTemplatePK
WHERE t1.PersonFK = 100070



SELECT COUNT(*) FROM MatrixGoal

SELECT TOP 2000 * 
FROM MatrixGoal
ORDER BY CrtSetTs DESC


SELECT RsrcID, TypCd, StsCd, GoalPeriodID,GoalDescTxt, CrtSetTs
FROM MatrixGoal
ORDER BY CrtSetTs DESC


SELECT TOP 30 * FROM GoalPeriod

SELECT t2.MsgTxt, t1.*
FROM GoalPeriod t1
JOIN Message t2 ON t1.NmCd = t2.MsgCd
WHERE t2.LngCd = 0

--CSV
SELECT *
FROM JobUser t1
JOIN Person t2 on t1.PersonFK=t2.PersonPK



SELECT TOP 30 t2.msgxt, t1.svyid
FROM SurveyDefinition t1
JOIN Message t2 ON t1.TtlID = t2.MsgCd
WHERE t2.LngCd = 0
ORDER BY t1.CrtSetTs DESC


SELECT * FROM SurveyDefinition WHERE SvyID = 'FJ7JOSEI7E41GT00A1BBUQ3V'


UPDATE SResource SET Mgr1ID = 1 WHERE RsrcID = 1
UPDATE HRMSPosition SET Mgr1ID = 1 WHERE RsrcID = 1





SELECT TOP 50 t1.RsrcID, t4.MsgTxt
FROM MatrixGoal t1
LEFT JOIN Event t2 ON t1.RsrcID = t2.OwnrID
JOIN EventDefinition t3 ON t2.TypCd = t3.TypCd
JOIN Message t4 ON t3.NmCd = t4.MsgCd
WHERE t1.GoalPeriodID = '' AND t2.StsCd IN (1,2) AND t4.LngCd = 0
ORDER BY t1.CrtSetTs DESC


SELECT dta, COUNT(*)
FROM UserDashboardProfile
WHERE TypCd = 26002
GROUP BY dta



SELECT COUNT(*)
FROM UserDashboardProfile
WHERE dta = '<dashboard>
	<column>
		<rptlet state=""0"" typcd=""26142"" rowid=""8""></rptlet>
		<rptlet state=""0"" typcd=""26280"" rowid=""1""></rptlet>
		<rptlet state=""0"" typcd=""26283"" rowid=""13""></rptlet>
		<rptlet state=""1"" typcd=""26261"" rowid=""16""></rptlet>
	</column>
	<column>
		<rptlet state=""0"" typcd=""100025"" rowid=""14""></rptlet>
		<rptlet state=""0"" typcd=""26810"" rowid=""15""></rptlet>
	</column>
</dashboard>
'



SELECT COUNT(*) FROM MatrixGoal WHERE GoalDescTxt = 'Dev area 2'

SELECT * FROM SResource WHERE RsrcID = 105401



SELECT TOP 30 * FROM SumtEventLog ORDER BY CreatedDate DESC



SELECT *
FROM EmailOut t1
JOIN Person t2 ON t1.RsrcID = t2.PersonPK
JOIN Event t3 ON t1.EvntID = t3.EvntID


SELECT TOP 10 * FROM EmailOut
SELECT TOP 10 * FROM EmailOutArc


SELECT TOP 100 *
FROM EventDefinition t1
JOIN Message t2 ON t1.NmCd = t2.MsgCd
WHERE t2.LngCd = 0
ORDER BY t1.CrtSetTs DESC

--100043

SELECT TOP 30 *
FROM Event t1
JOIN Person t2 ON t1.OwnrID = t2.PersonPK
JOIN PersonTM t3 ON t2.PersonPK = t3.PersonFK
WHERE t1.TypCd = 100043

SELECT t3.HierarchyLvl0, COUNT(*)
FROM Event t1
JOIN Person t2 ON t1.OwnrID = t2.PersonPK
JOIN PersonTM t3 ON t2.PersonPK = t3.PersonFK
WHERE t1.TypCd = 100043
GROUP BY t3.HierarchyLvl0

--100006
--Office of Library Technology

SELECT TOP 10 * FROM Organization



SELECT TOP 30 * FROM OrganizationUser


SELECT TOP 1000 SynchFaultFlg, SynchFaultCntLstAry
FROM SResource
ORDER BY CrtSetTS DESC


SELECT COUNT(*) FROM SResource WHERE SynchFaultFlg = 1 AND LstMdTs BETWEEN '09/16/16' AND '09/17/16'
SELECT COUNT(*) FROM OrganizationUser WHERE SynchFaultFlg = 1 AND LstMdTs BETWEEN '09/16/16' AND '09/17/16'



SELECT TOP 50 * FROM MatrixGoal WHERE GoalPeriodID = '' ORDER BY CrtSetTs DESC


SELECT * FROM SResource WHERE LstNm = 'Hansen'



--Set synch flag 
UPDATE SResource 
SET SynchFaultFlg = 2 
WHERE RsrcID > 11 AND RsrcID IN
(
	SELECT RsrcID FROM UserSystemProfile WHERE ReceiveAutoEmailsFlg IS NULL
) 

--Update email flag
UPDATE UserSystemProfile 
SET ReceiveAutoEmailsFlg = 1
WHERE RsrcID > 11 AND ReceiveAutoEmailsFlg IS NULL

--Run Employee Data Synchronization batch job


SELECT TOP 30 *
FROM SResource t1
JOIN UserSystemProfile t2 ON t1.RsrcID = t2.RsrcID
ORDER BY t1.CrtSetTS DESC


SELECT * FROM UserDashboardProfile


SELECT TypCd, RsrcID, DelFlg, CrtSetTs, LstMdUsrID, LsdtMdTs
FROM UserDashboardProfile



SELECT TOP 100 *
FROM Organization t1
LEFT JOIN OrganizationLang t2 ON t1.OrganizationPK = t2.OrganizationFK
WHERE t1.Code = '54610430'



SELECT t3.MsgTxt, COUNT(*)
FROM MatrixGoal t1
JOIN GoalPeriod t2 ON t1.GoalPeriodID = t2.GoalPeriodID
JOIN Message t3 ON t2.NmCd = t3.MsgCd
WHERE t3.LngCd = 0 AND t1.TypCd = 5007
GROUP BY t3.MsgTxt

SELECT TOP 20 *
FROM SResource
WHERE RsrcID NOT IN
(
	SELECT RsrcID FROM UserDashboardProfile WHERE TypCd = 26002
)
AND StsCd = 0 
ORDER BY CrtSetTs DESC

SELECT TOP 20 * FROM UserDashboardProfile ORDER BY CrtSetTs DESC


SELECT TOP 30 *
FROM MatrixGoal
WHERE StsCd = 6 AND NtsTxt = ''
ORDER BY CrtSetTs DESC


SELECT *
FROM MatrixGoal
WHERE VerNum > 0 AND ActiveFlg = 1 AND NtsTxt = '' AND GoalPeriodID = 'EOQRKQQGSPC48UO0A1BBU53E'



-- This batch job is a temporary measure for TM-29403 to address data loss associated with a defect with rich text goal fields

DECLARE @ActID VARCHAR(24)
DECLARE @VerNum SMALLINT
DECLARE @PreviousText NVARCHAR(MAX)

-- Retrieve goals with missing NtsTxt
DECLARE rs_MatrixGoal CURSOR FOR
SELECT ActID, VerNum FROM MatrixGoal WHERE TypCd = 5005 AND GoalPeriodID = 'Q5FT1DMMU8410SO0A1BBU3PL' AND VerNum > 0 AND ActiveFlg = 1 AND DelFlg = 0 AND ISNULL(NtsTxt,'') = ''

OPEN rs_MatrixGoal
FETCH NEXT FROM rs_MatrixGoal INTO @ActID, @VerNum

WHILE @@FETCH_STATUS = 0
BEGIN
    -- Retrieve last value of NtsTxt
    SET @PreviousText = ISNULL((SELECT NtsTxt FROM MatrixGoal WHERE ActID = @ActID AND VerNum = (SELECT MAX(VerNum) FROM MatrixGoal WHERE ActID = @ActID AND NtsTxt <> '')),'')
    
    -- Update active record with last value of NtsTxt
    UPDATE MatrixGoal SET NtsTxt = @PreviousText WHERE ActID = @ActID AND VerNum = @VerNum
    
    FETCH NEXT FROM rs_MatrixGoal INTO @ActID, @VerNum
END

CLOSE rs_MatrixGoal
DEALLOCATE rs_MatrixGoal

-- Retrieve goals with missing ResultsTxt
DECLARE rs_MatrixGoal CURSOR FOR
SELECT ActID, VerNum FROM MatrixGoal WHERE TypCd = 5005 AND GoalPeriodID = 'Q5FT1DMMU8410SO0A1BBU3PL' AND VerNum > 0 AND ActiveFlg = 1 AND DelFlg = 0 AND ISNULL(ResultsTxt,'') = ''

OPEN rs_MatrixGoal
FETCH NEXT FROM rs_MatrixGoal INTO @ActID, @VerNum

WHILE @@FETCH_STATUS = 0
BEGIN
    -- Retrieve last value of ResultsTxt
    SET @PreviousText = ISNULL((SELECT ResultsTxt FROM MatrixGoal WHERE ActID = @ActID AND VerNum = (SELECT MAX(VerNum) FROM MatrixGoal WHERE ActID = @ActID AND ResultsTxt <> '')),'')
    
    -- Update active record with last value of ResultsTxt
    UPDATE MatrixGoal SET ResultsTxt = @PreviousText WHERE ActID = @ActID AND VerNum = @VerNum
    
    FETCH NEXT FROM rs_MatrixGoal INTO @ActID, @VerNum
END

CLOSE rs_MatrixGoal
DEALLOCATE rs_MatrixGoal

-- Retrieve goals with missing Custom10Txt
DECLARE rs_MatrixGoal CURSOR FOR
SELECT ActID, VerNum FROM MatrixGoal WHERE TypCd = 5005 AND GoalPeriodID = 'Q5FT1DMMU8410SO0A1BBU3PL' AND VerNum > 0 AND ActiveFlg = 1 AND DelFlg = 0 AND ISNULL(Custom10Txt,'') = ''

OPEN rs_MatrixGoal
FETCH NEXT FROM rs_MatrixGoal INTO @ActID, @VerNum

WHILE @@FETCH_STATUS = 0
BEGIN
    -- Retrieve last value of Custom10Txt
    SET @PreviousText = ISNULL((SELECT Custom10Txt FROM MatrixGoal WHERE ActID = @ActID AND VerNum = (SELECT MAX(VerNum) FROM MatrixGoal WHERE ActID = @ActID AND Custom10Txt <> '')),'')
    
    -- Update active record with last value of Custom10Txt
    UPDATE MatrixGoal SET Custom10Txt = @PreviousText WHERE ActID = @ActID AND VerNum = @VerNum
    
    FETCH NEXT FROM rs_MatrixGoal INTO @ActID, @VerNum
END

CLOSE rs_MatrixGoal
DEALLOCATE rs_MatrixGoal


SELECT TOP 20 * FROM MatrixGoal AND GoalPeriodID = 'EOQRKQQGSPC48UO0A1BBU53E' AND ActiveFlg = 1 AND DelFlg = 0 AND NtsTxt='<br>'



SELECT TOP 30 * 
FROM BatchJob
WHERE DescrTxt LIKE '%Position%' AND DelFlg = 0


SELECT TOP 1000 *
FROM BatchLog
WHERE JobID IN ('2DQP9H6HNEBM0K00A1BBUQUB', '3308459MU44QNU00A1B8S05N', 'QR26LTRB6SQAQV80A1B8SRK7')
ORDER BY StartTs DESC



SELECT TOP 20 *
FROM MatrixGoal
WHERE NtsTxt = '<br>' AND CrtSetTs BETWEEN '10/3/16' AND '10/4/16'

SELECT TOP 10 * FROM SScript


SELECT TOP 10 * FROM SScript WHERE ScrptID IN ('O629PJGDSMATQU00A1B8SRK7', 'NGR0NUVHQLAFPI00A1B8S05N', 'MQI3G6T2H7IVCJG0A1BBUQUB')


select synchfaultflg, count(*)
from persontm
where personfk in
(
select personpk from person where active = 1
)
group by synchfaultflg


SELECT *
FROM Person t1
JOIN PersonTM t2 ON t1.PersonPK = t2.PersonFK
WHERE t2.SynchFaultFlg <> 0

WebPartPageDefinition
WebPartPage


UPDATE WebPartPage SET Description = 'Default Dashboard', URL = '#/dash/home' WHERE ID = 1


Url
#/dash/home
#/dash/learning
#/dash/profile
#/dash/fte
#/dash/Talent
#/dash/abcdefg



Update JobTemplate set JobCd = JobNum

UPDATE r1
SET r1.JobTitleId = j.actid
FROM personrelation r1
JOIN jobtemplate j ON isnull(r1.JobTitleId, '') = j.jobnum


UPDATE p
SET p.jbtmplid = j.actid, p.jbtmplnm = j.jobnum
FROM HRMSposition p 
join JobTemplate j on p.jbtmplid = j.jobnum
WHERE isnull(p.JbTmplID ,'') <> j.actid

select count(*) from
from person t1
join userlogin t2 on t1.personpk = t2.personfk
where t1.personnumber = t2.username

select count(*) from
from person t1
join userlogin t2 on t1.personpk = t2.personfk
where t1.personnumber <> t2.usernamese



UPDATE WebPartPage SET Url = '#/dash/home/_adjunct' WHERE Id = 208

/*
Sets the priority for the Adjunct dashboard to be lower than the other dashboards.  
As of W16 version there is no way of setting the priority through the UI.
*/

UPDATE WebPartPage SET Priority = 1 WHERE Id = 202



SELECT TOP 30 *
FROM Person t1
JOIN PersonTM t2 ON t1.PersonPK = t2.PersonFK
ORDER BY t1.CreatedDate DESC



SELECT t2.MsgTxt, t1.SvyID, t1.CrtSetTs
FROM SurveyDefinition t1
JOIN Message t2 ON T1.TtlID = t2.MsgCd
WHERE t2.LngCd = 0 AND t1.DelFlg = 0
ORDER BY t1.CrtSetTs DESC


IF NOT EXISTS (SELECT Id FROM SettingDefinition WHERE SettingDefinitionKey = 'SECURITY_WHITELISTED_HOSTS')
INSERT INTO SETTINGDEFINITION (SettingDefinitionKey, Name, Description, DefaultValue, IsClientSpecific, OrdinalPosition, ConfigurationCategoryId) VALUES ('SECURITY_WHITELISTED_HOSTS', 'White listed hosts', 'Whitelisted domains for redirection from within the application', '', 1, 1, (SELECT Id FROM ConfigurationCategory WHERE CategoryKey = 'SETTINGS_ELIXHR'))
GO

IF NOT EXISTS (SELECT 1 FROM Setting WHERE SettingDefinitionId = (SELECT Id FROM SettingDefinition WHERE SettingDefinitionKey = 'SECURITY_WHITELISTED_HOSTS'))
INSERT INTO Setting (Value, ObjectType, ObjectId, SettingDefinitionId) VALUES ('prodsup.geolearning.com', NULL, -1, (SELECT Id FROM SettingDefinition WHERE SettingDefinitionKey = 'SECURITY_WHITELISTED_HOSTS'))
ELSE
UPDATE Setting SET Value = CONCAT(Value, 'prodsup.geolearning.com') WHERE SettingDefinitionId = (SELECT Id FROM SettingDefinition WHERE SettingDefinitionKey = 'SECURITY_WHITELISTED_HOSTS')
GO


SELECT * FROM Setting WHERE SettingDefinitionID = (SELECT Id FROM SettingDefinition WHERE SettingDefinitionKey = 'SECURITY_WHITELISTED_HOSTS')


UPDATE Setting 


UPDATE TBL_NTF_Config SET AdminEmail = 'HRIS@boartlongyear.com' WHERE PK = 1



SELECT TOP 30 * FROM Hierarchy

SELECT TOP 30 * FROM Organization WHERE HierarchyFK = 100004

SELECT TOP 30 * FROM OrganizationLang WHERE OrganizationFK = 100054

--100054


-- Added for W16.  JobCd is unique identifier for PRIMARY_JOB import.  JobCd is not always provided,
-- so this script sets the JobCd to be the same as the JobNum.
UPDATE JobTemplate SET JobCd = JobNum

UPDATE t1
SET t1.JobTitle = t2.Text1
FROM PersonRelation t1
JOIN PersonOptional1 t2 ON t1.PersonFK = t2.PersonFK
WHERE t2.Text1 IS NOT NULL AND t1.JobTitle <> t2.Text1


-- Code below was used prior to W16, though is no longer relevant.
/*
UPDATE r1
SET r1.JobTitleId = j.actid
FROM personrelation r1
JOIN jobtemplate j ON isnull(r1.JobTitleId, '') = j.jobnum

UPDATE p
SET p.jbtmplid = j.actid, p.jbtmplnm = j.jobnum
FROM HRMSposition p 
join JobTemplate j on p.jbtmplid = j.jobnum
WHERE isnull(p.JbTmplID ,'') <> j.actid
*/



--Reload client W16 URL
--https://portofhouston.stage.sumtotal.host/scripts/lightyearisapi.dll?reloadclient&reloadid=470 

UPDATE UserLogin
SET AccountConfigLevelCode = 3 WHERE PersonFK = 100705

SELECT TOP 1 * FROM ReportDefinition ORDER BY CrtSetTs DESC


SELECT TOP 30 t1.TypCd, t2.MsgTxt, t1.DescrTxt, t1.CrtSetTs, t1.LstMdTs
FROM ReportDefinition t1
JOIN Message t2 ON t1.NmCd = t2.MsgCd
WHERE t2.LngCd = 0
ORDER BY t1.CrtSetTs DESC


SELECT t2.MsgTxt, t1.*
FROM NavigationItem t1
JOIN Message t2 ON t1.NmCd = t2.MsgCd
WHERE t2.LngCd=0

UPDATE MatrixGoal
SET GoalDescTxt = RIGHT(GoalDescTxt, LEN(GoalDescTxt) - 8)
WHERE GoalPeriodID = 'BA6G1JLBUS1S15G0A1B8SRNT'


-- Synch Cost Center (HierarchyLvl2) to Department
UPDATE t1
SET t1.DeptNum = t3.Name
FROM PersonRelation t1
JOIN PersonTM t2 ON t1.PersonFK = t2.PersonFK
JOIN Organization t3 ON t2.HierarchyLvl4 = t1.OrganizationPK
WHERE t2.HierarchyLvl2 IS NOT NULL AND t2.HierarchyLvl2 <> ''



UPDATE t1
SET t1.GoalDescTxt = t2.GoalDescTxt
FROM MatrixGoal t1
JOIN MatrixGoal t2 ON t1.



-- Removes 'Copy of ' from copied Org goals
UPDATE MatrixGoal
SET GoalDescTxt = REPLACE(GoalDescTxt, 'Copy of ', '')
WHERE GoalPeriodID = 'EOJSV586VMFTJK00A1BBU13U'




UPDATE t1
SET t1.DynCriteriaID = t2.DynCriteriaID, t1.ResultsTxt = t2.ResultsTxt
FROM MatrixGoal t1
INNER JOIN MatrixGoal t2 ON t1.GoalDescTxt = t2.GoalDescTxt
WHERE t1.GoalPeriodID = 'BA6G1JLBUS1S15G0A1B8SRNT' AND t2.GoalPeriodID = 'V7T6NHVB3LLV8UG0A1BBUIVG'

UPDATE MatrixGoal
SET DynamicActiveFlg = 1
WHERE GoalPeriodID = 'BA6G1JLBUS1S15G0A1B8SRNT'
AND DynCriteriaID IS NOT NULL




--2016
SELECT *
FROM MatrixGoal t1
INNER JOIN MatrixGoal t2 ON t1.GoalDescTxt = t2.GoalDescTxt
WHERE t1.GoalPeriodID = 'BA6G1JLBUS1S15G0A1B8SRNT' AND t2.GoalPeriodID = 'V7T6NHVB3LLV8UG0A1BBUIVG' AND t1.TypCd = 5007 AND t2.TypCd = 5007 AND t1.ActiveFlg = 1 AND t2.ActiveFlg = 1 AND t1.DelFlg = 0 AND t2.DelFlg = 0

--2015
SELECT *
FROM MatrixGoal t1
INNER JOIN MatrixGoal t2 ON t1.GoalDescTxt = t2.GoalDescTxt
WHERE t1.GoalPeriodID = 'EOJSV586VMFTJK00A1BBU13U' AND t2.GoalPeriodID = 'V7T6NHVB3LLV8UG0A1BBUIVG' AND t1.TypCd = 5007 AND t2.TypCd = 5007 AND t1.ActiveFlg = 1 AND t2.ActiveFlg = 1 AND t1.DelFlg = 0 AND t2.DelFlg = 0


--Test 1
UPDATE t1
SET t1.DynCriteriaID = t2.DynCriteriaID, t1.ResultsTxt = t2.ResultsTxt
FROM MatrixGoal t1
INNER JOIN MatrixGoal t2 ON t1.GoalDescTxt = t2.GoalDescTxt
WHERE t1.GoalPeriodID = 'BA6G1JLBUS1S15G0A1B8SRNT' AND t2.GoalPeriodID = 'V7T6NHVB3LLV8UG0A1BBUIVG' AND t1.TypCd = 5007 AND t2.TypCd = 5007 AND t1.ActiveFlg = 1 AND t2.ActiveFlg = 1 AND t1.DelFlg = 0 AND t2.DelFlg = 0 AND t1.ActID = 'VTCFL27A5VMFQPG0A1B8SF1F'

UPDATE MatrixGoal
SET DynamicActiveFlg = 1
WHERE GoalPeriodID = 'BA6G1JLBUS1S15G0A1B8SRNT' AND DynCriteriaID IS NOT NULL AND t1.ActID = 'VTCFL27A5VMFQPG0A1B8SF1F'


--Confirm Test 1
SELECT t1.ActID, t1.GoalDescTxt, t1.DynamicActiveFlg, t1.DynCriteriaID, t1.ResultsTxt, t2.ActID, t2.GoalDescTxt, t2.DynamicActiveFlg, t2.DynCriteriaID, t2.ResultsTxt
FROM MatrixGoal t1
INNER JOIN MatrixGoal t2 ON t1.GoalDescTxt = t2.GoalDescTxt
WHERE t1.GoalPeriodID = 'BA6G1JLBUS1S15G0A1B8SRNT' AND t2.GoalPeriodID = 'V7T6NHVB3LLV8UG0A1BBUIVG' AND t1.TypCd = 5007 AND t2.TypCd = 5007 AND t1.ActiveFlg = 1 AND t2.ActiveFlg = 1 AND t1.DelFlg = 0 AND t2.DelFlg = 0 AND t1.ActID = 'VTCFL27A5VMFQPG0A1B8SF1F'


--Full Update stage
UPDATE t1
SET t1.DynCriteriaID = t2.DynCriteriaID, t1.ResultsTxt = t2.ResultsTxt
FROM MatrixGoal t1
INNER JOIN MatrixGoal t2 ON t1.GoalDescTxt = t2.GoalDescTxt
WHERE t1.GoalPeriodID = 'BA6G1JLBUS1S15G0A1B8SRNT' AND t2.GoalPeriodID = 'V7T6NHVB3LLV8UG0A1BBUIVG' AND t1.TypCd = 5007 AND t2.TypCd = 5007 AND t1.ActiveFlg = 1 AND t2.ActiveFlg = 1 AND t1.DelFlg = 0 AND t2.DelFlg = 0

UPDATE MatrixGoal
SET DynamicActiveFlg = 1
WHERE GoalPeriodID = 'BA6G1JLBUS1S15G0A1B8SRNT' AND DynCriteriaID IS NOT NULL

--Full Update prod
UPDATE t1
SET t1.DynCriteriaID = t2.DynCriteriaID, t1.ResultsTxt = t2.ResultsTxt
FROM MatrixGoal t1
INNER JOIN MatrixGoal t2 ON t1.GoalDescTxt = t2.GoalDescTxt
WHERE t1.GoalPeriodID = 'EOJSV586VMFTJK00A1BBU13U' AND t2.GoalPeriodID = 'V7T6NHVB3LLV8UG0A1BBUIVG' AND t1.TypCd = 5007 AND t2.TypCd = 5007 AND t1.ActiveFlg = 1 AND t2.ActiveFlg = 1 AND t1.DelFlg = 0 AND t2.DelFlg = 0

UPDATE MatrixGoal
SET DynamicActiveFlg = 1
WHERE GoalPeriodID = 'EOJSV586VMFTJK00A1BBU13U' AND DynCriteriaID IS NOT NULL

--Back out plan
UPDATE MatrixGoal
SET DynCriteriaID = '', ResultsTxt = '', DynamicActiveFlg = 0
WHERE GoalPeriodID = 'BA6G1JLBUS1S15G0A1B8SRNT'


UPDATE Setting SET Value = 'gm1.geolearning.com' WHERE Id = 9

--Modify LM email from address
UPDATE TBL_NTF_Config SET AdminEmail = 'DONOTREPLY@danvilleva.gov' WHERE PK = 1

	select top 30 t1.firstname, t1.lastname, t2.jobtitle, t2.jobtitleid, t3.jobname
	from person t1
	join personrelation t2 on t1.personpk=t2.personfk
	left join jobtemplate t3 on t2.jobtitleid=t3.jobtemplatepk
	where t1.firstname='test'

--select top 30 * from jobtemplate

/*
select top 30 * 
from person t1
join personrelation t2 on t1.personpk=t2.personfk
where t1.firstname='test'
*/

--Copy HR Manager relationship to Manager5
UPDATE PersonRelation
SET Manager5Fk = ProcessCoordinatorFK

--Unlock Administrator account
UPDATE UserLogin
SET PwdExpiryDate = '01/01/2020 00:00:00.000' WHERE PersonFK = -1

--Reset failed synch count on test account
UPDATE PersonTM
SET SynchFaultRetryCt = 1
WHERE PersonFK = 104069

--Trigger synch flag on test account
UPDATE PersonTM
SET SynchFaultFlg = 2
WHERE PersonFK = 104069

--Update Denise's security profile
UPDATE UserLogin
SET SecurityProfileFK = '7KA6FPH5S6E45J004JK2UCFK'
WHERE PersonFK = 315987

--Update Greg's security profile
UPDATE UserLogin
SET SecurityProfileFK = '7KA6FPH5S6E45J004JK2UCFK'
WHERE PersonFK = 100705

--backout BGN5IJS5992CV0G0A1BBUAKA


UPDATE RelyingParty
SET LogOffURL = 'https://gm1.geolearning.com/geonext/sundt/logout.geo'
WHERE RPKey = 'MaestroLM'


7KA6FPH5S6E45J004JK2UCFK



UPDATE MatrixGoal
SET GoalTypCd = 2, LstMdUsrID = -1, LstMdTs = CURRENT_TIMESTAMP
WHERE GoalTypCd = 4 AND GoalPeriodID = 'BV32Q7V964GVM280A1BBUDO8' AND DelFlg = 0



UPDATE MatrixGoal
SET GoalTypCd = 2 
WHERE ActID = 'T60ADN75A1TAF900A1BBUDO8'


--Fix missing Approval Manager navigation link
UPDATE MasterSitemap
SET NodeKey = 'ManageTrainingRequest'
WHERE ID = 835

--backout
UPDATE MasterSitemap
SET NodeKey = 'ManageTrainingRequests'
WHERE ID = 835


UPDATE EventDefinition
SET Dta = 'qry_competency_name_orderby_1=&pages=1%2c3%2c5&maintainorder=1&batchidlateevent=&batchidnewevent=&sdatasvyidself=P3MK70KFB0DG9900A1BBUIVG&sdatasvyidother=P3MK70KFB0DG9900A1BBUIVG'
WHERE TypCd = 100112



UPDATE RelyingParty
SET LogOffURL = 'https://gm1.geolearning.com/geonext/arise/logout.geo'
WHERE RPKey = 'MaestroLM'

-- Fix skill-specific 360 process
UPDATE EventDefinition
SET Dta = 'pages=1%2c3%2c5&maintainorder=1&batchidlateevent=&batchidnewevent=&sdatasvyidself=P3MK70KFB0DG9900A1BBUIVG&sdatasvyidother=P3MK70KFB0DG9900A1BBUIVG'
WHERE TypCd = 100112

-- Revert
--UPDATE EventDefinition
--SET Dta = 'qry_competency_cmpnm_orderby_1=&pages=1%2c3%2c5&maintainorder=1&batchidlateevent=&batchidnewevent=&sdatasvyidself=P3MK70KFB0DG9900A1BBUIVG&sdatasvyidother=P3MK70KFB0DG9900A1BBUIVG'
--WHERE TypCd = 100112



UPDATE MasterSitemap
SET NodeKey = 'UserProfile'
WHERE Id = 10002


UPDATE t2
SET t2.MaestroEmpID = t1.PersonNumber
FROM Person t1
JOIN PersonTM t2 ON t1.PersonPK = t2.PersonFK
WHERE t1.PersonPK = 



UPDATE PersonTM
SET MaestroEmpID = '1752'
WHERE PersonFK = 100862